(function(n,t){"use strict";var u,f,i,r;if(typeof n!="function")throw"SignalR: jQuery not found. Please ensure jQuery is referenced before the SignalR.js file.";if(!t.JSON)throw"SignalR: No JSON parser found. Please ensure json2.js is referenced before the SignalR.js file if you need to support clients without native JSON parsing support, e.g. IE<8.";i=function(n){var i;if(typeof t.console=="undefined")return;i="["+(new Date).toTimeString()+"] SignalR: "+n,t.console.debug?t.console.debug(i):t.console.log&&t.console.log(i)},u=function(n,t){return new u.fn.init(n,t)},u.fn=u.prototype={init:function(n,t){this.url=n,this.qs=t},reconnectDelay:2e3,start:function(i,r){var f=this,e={transport:"auto"},s,o=n.Deferred();return f.transport?(o.resolve(f),o):(n.type(i)==="function"?r=i:n.type(i)==="object"&&(n.extend(e,i),n.type(e.callback)==="function"&&(r=e.callback)),n(f).bind("onStart",function(){n.type(r)==="function"&&r.call(f),o.resolve(f)}),s=function(t,i){i=i||0;if(i>=t.length){f.transport||o.reject("SignalR: No transport could be initialized successfully. Try specifying a different transport or none at all for auto initialization.");return}var r=t[i],e=n.type(r)==="object"?r:u.transports[r];e.start(f,function(){f.transport=e,n(f).trigger("onStart")},function(){s(t,i+1)})},t.setTimeout(function(){n.ajax(f.url+"/negotiate",{global:!1,type:"POST",data:{},success:function(t){f.appRelativeUrl=t.Url,f.id=t.ConnectionId,f.webSocketServerUrl=t.WebSocketServerUrl;if(!t.ProtocolVersion||t.ProtocolVersion!=="1.0")throw"SignalR: Incompatible protocol version.";n(f).trigger("onStarting");var r=[],i=[];n.each(u.transports,function(n){if(n==="webSockets"&&!t.TryWebSockets)return!0;i.push(n)}),n.isArray(e.transport)?n.each(e.transport,function(){var t=this;n.type(t)!=="object"&&(n.type(t)!=="string"||n.inArray(""+t,i)<0)||r.push(n.type(t)==="string"?""+t:t)}):n.type(e.transport)!=="object"&&n.inArray(e.transport,i)<0?r=i:r.push(e.transport),s(r)}})},0),o)},starting:function(t){var i=this,r=n(i);return r.bind("onStarting",function(){t.call(i),r.unbind("onStarting")}),i},send:function(n){var t=this;if(!t.transport)throw"SignalR: Connection must be started before data can be sent. Call .start() before .send()";return t.transport.send(t,n),t},sending:function(t){var i=this;return n(i).bind("onSending",function(){t.call(i)}),i},received:function(t){var i=this;return n(i).bind("onReceived",function(n,r){t.call(i,r)}),i},error:function(t){var i=this;return n(i).bind("onError",function(n,r){t.call(i,r)}),i},disconnect:function(t){var i=this;return n(i).bind("onDisconnect",function(){t.call(i)}),i},reconnect:function(t){var i=this;return n(i).bind("onReconnect",function(){t.call(i)}),i},stop:function(){var n=this;return n.transport&&(n.transport.stop(n),n.transport=null),delete n.messageId,delete n.groups,n},log:i},u.fn.init.prototype=u.fn,r={addQs:function(t,i){return i.qs?typeof i.qs=="object"?t+"&"+n.param(i.qs):typeof i.qs=="string"?t+"&"+i.qs:t+"&"+escape(i.qs.toString()):t},getUrl:function(n,i,r){var u=n.url,f="transport="+i+"&connectionId="+t.escape(n.id);return n.data&&(f+="&connectionData="+t.escape(n.data)),r?(n.messageId&&(f+="&messageId="+n.messageId),n.groups&&(f+="&groups="+t.escape(JSON.stringify(n.groups)))):u=u+"/connect",u+="?"+f,u=this.addQs(u,n)},ajaxSend:function(i,r){var u=i.url+"/send?transport="+i.transport.name+"&connectionId="+t.escape(i.id);u=this.addQs(u,i),n.ajax(u,{global:!1,type:"POST",dataType:"json",data:{data:r},success:function(t){t&&n(i).trigger("onReceived",[t])},error:function(t,r){if(r==="abort")return;n(i).trigger("onError",[t])}})},processMessages:function(t,r){var u=n(t);if(r){if(r.Disconnect){i("disconnect command received from server"),t.stop(),u.trigger("onDisconnect");return}r.Messages&&n.each(r.Messages,function(){try{u.trigger("onReceived",[this])}catch(r){i("Error raising received "+r),n(t).trigger("onError",[r])}}),t.messageId=r.MessageId,t.groups=r.TransportData.Groups}},foreverFrame:{count:0,connections:{}}},u.transports={webSockets:{name:"webSockets",send:function(n,t){n.socket.send(t)},start:function(r,u,f){var e,s=!1,o;t.MozWebSocket&&(t.WebSocket=t.MozWebSocket);if(!t.WebSocket){f();return}r.socket||(r.webSocketServerUrl?e=r.webSocketServerUrl:(o=document.location.protocol==="https:"?"wss://":"ws://",e=o+document.location.host+r.appRelativeUrl),n(r).trigger("onSending"),e+=r.data?"?connectionData="+r.data+"&transport=webSockets&connectionId="+r.id:"?transport=webSockets&connectionId="+r.id,r.socket=new t.WebSocket(e),r.socket.onopen=function(){s=!0,u&&u()},r.socket.onclose=function(t){s?typeof t.wasClean!="undefined"&&t.wasClean===!1&&n(r).trigger("onError"):f&&f(),r.socket=null},r.socket.onmessage=function(u){var f=t.JSON.parse(u.data),e;f&&(e=n(r),f.Messages?n.each(f.Messages,function(){try{e.trigger("onReceived",[this])}catch(n){i("Error raising received "+n)}}):e.trigger("onReceived",[f]))})},stop:function(n){n.socket!==null&&(n.socket.close(),n.socket=null)}},serverSentEvents:{name:"serverSentEvents",timeOut:3e3,start:function(u,f,e){var o=this,c=!1,h=n(u),s=!f,a,l;u.eventSource&&u.stop();if(!t.EventSource){e&&e();return}h.trigger("onSending"),a=r.getUrl(u,this.name,s);try{u.eventSource=new t.EventSource(a)}catch(v){i("EventSource failed trying to connect with error "+v.Message),e?e():(h.trigger("onError",[v]),s&&(i("EventSource reconnecting"),o.reconnect(u)));return}l=t.setTimeout(function(){c===!1&&(i("EventSource timed out trying to connect"),e&&e(),s?(i("EventSource reconnecting"),o.reconnect(u)):o.stop(u))},o.timeOut),u.eventSource.addEventListener("open",function(){i("EventSource connected"),l&&t.clearTimeout(l),c===!1&&(c=!0,f&&f(),s&&h.trigger("onReconnect"))},!1),u.eventSource.addEventListener("message",function(n){if(n.data==="initialized")return;r.processMessages(u,t.JSON.parse(n.data))},!1),u.eventSource.addEventListener("error",function(n){if(!c){e&&e();return}i("EventSource readyState: "+u.eventSource.readyState),n.eventPhase===t.EventSource.CLOSED?u.eventSource.readyState===t.EventSource.CONNECTING?(i("EventSource reconnecting due to the server connection ending"),o.reconnect(u)):(i("EventSource closed"),o.stop(u)):(i("EventSource error"),h.trigger("onError"))},!1)},reconnect:function(n){var i=this;t.setTimeout(function(){i.stop(n),i.start(n)},n.reconnectDelay)},send:function(n,t){r.ajaxSend(n,t)},stop:function(n){n&&n.eventSource&&(n.eventSource.close(),n.eventSource=null,delete n.eventSource)}},foreverFrame:{name:"foreverFrame",timeOut:3e3,start:function(u,f,e){var s=this,c=r.foreverFrame.count+=1,h,l,o=n("<iframe data-signalr-connection-id='"+u.id+"' style='position:absolute;width:0;height:0;visibility:hidden;'></iframe>");if(t.EventSource){e&&e();return}n(u).trigger("onSending"),h=r.getUrl(u,this.name),h+="&frameId="+c,o.prop("src",h),r.foreverFrame.connections[c]=u,o.bind("readystatechange",function(){n.inArray(this.readyState,["loaded","complete"])<0||(i("Forever frame iframe readyState changed to "+this.readyState+", reconnecting"),s.reconnect(u))}),u.frame=o[0],u.frameId=c,f&&(u.onSuccess=f),n("body").append(o),l=t.setTimeout(function(){u.onSuccess&&(s.stop(u),e&&e())},s.timeOut)},reconnect:function(n){var i=this;t.setTimeout(function(){var u=n.frame,t=r.getUrl(n,i.name,!0)+"&frameId="+n.frameId;u.src=t},n.reconnectDelay)},send:function(n,t){r.ajaxSend(n,t)},receive:r.processMessages,stop:function(t){t.frame&&(t.frame.stop?t.frame.stop():t.frame.document&&t.frame.document.execCommand&&t.frame.document.execCommand("Stop"),n(t.frame).remove(),delete r.foreverFrame.connections[t.frameId],t.frame=null,t.frameId=null,delete t.frame,delete t.frameId)},getConnection:function(n){return r.foreverFrame.connections[n]},started:function(t){t.onSuccess?(t.onSuccess(),t.onSuccess=null,delete t.onSuccess):n(t).trigger("onReconnect")}},longPolling:{name:"longPolling",start:function(i,u){var e=this;i.pollXhr&&i.stop(),i.messageId=null,t.setTimeout(function(){(function f(u){n(u).trigger("onSending");var h=u.messageId,o=h===null,s=r.getUrl(u,e.name,!o);o||t.setTimeout(function(){n(u).trigger("onReconnect")},100),u.pollXhr=n.ajax(s,{global:!1,type:"GET",dataType:"json",success:function(i){var e=0;r.processMessages(u,i),i&&n.type(i.TransportData.LongPollDelay)==="number"&&(e=i.TransportData.LongPollDelay),e>0?t.setTimeout(function(){f(u)},e):f(u)},error:function(r,e){if(e==="abort")return;n(u).trigger("onError",[r]),t.setTimeout(function(){f(u)},i.reconnectDelay)}})})(i),t.setTimeout(u,150)},250)},send:function(n,t){r.ajaxSend(n,t)},stop:function(n){n.pollXhr&&(n.pollXhr.abort(),n.pollXhr=null,delete n.pollXhr)}}},u.noConflict=function(){return n.connection===u&&(n.connection=f),u},n.connection&&(f=n.connection),n.connection=n.signalR=u})(window.jQuery,window)