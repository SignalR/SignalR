(function(n,t){"use strict";var i,f,u,r;if(typeof n!="function")throw"SignalR: jQuery not found. Please ensure jQuery is referenced before the SignalR.js file.";if(!t.JSON)throw"SignalR: No JSON parser found. Please ensure json2.js is referenced before the SignalR.js file if you need to support clients without native JSON parsing support, e.g. IE<8.";u=typeof console!="undefined"&&console&&console.debug?function(n){console.debug(n)}:n.noop,i=function(n){return new i.fn.init(n)},i.fn=i.prototype={init:function(n){this.url=n},start:function(r,u){var f=this,e={transport:"auto"},o;return f.transport?f:(n.type(r)==="function"?u=r:n.type(r)==="object"&&(n.extend(e,r),n.type(e.callback)==="function"&&(u=e.callback)),n.type(u)==="function"&&n(f).bind("onStart",function(){u.call(f)}),o=function(t,r){r=r||0;if(r>=t.length){if(!f.transport)throw"SignalR: No transport could be initialized successfully. Try specifying a different transport or none at all for auto initialization.";return}var u=t[r],e=n.type(u)==="object"?u:i.transports[u];e.start(f,function(){f.transport=e,n(f).trigger("onStart")},function(){o(t,r+1)})},t.setTimeout(function(){n.ajax(f.url+"/negotiate",{global:!1,type:"POST",data:{},success:function(t){f.appRelativeUrl=t.Url,f.clientId=t.ClientId,n(f).trigger("onStarting");var u=[],r=[];n.each(i.transports,function(n){r.push(n)}),n.isArray(e.transport)?n.each(e.transport,function(){var t=this;n.type(t)!=="object"&&(n.type(t)!=="string"||n.inArray(""+t,r)<0)||u.push(n.type(t)==="string"?""+t:t)}):n.type(e.transport)!=="object"&&n.inArray(e.transport,r)<0?u=r:u.push(e.transport),o(u)}})},0),f)},starting:function(t){var i=this;return n(i).bind("onStarting",function(){t.call(i)}),i},send:function(n){var t=this;if(!t.transport)throw"SignalR: Connection must be started before data can be sent. Call .start() before .send()";return t.transport.send(t,n),t},sending:function(t){var i=this;return n(i).bind("onSending",function(){t.call(i)}),i},received:function(t){var i=this;return n(i).bind("onReceived",function(n,r){t.call(i,r)}),i},error:function(t){var i=this;return n(i).bind("onError",function(){t.call(i)}),i},stop:function(){var n=this;return n.transport&&(n.transport.stop(n),n.transport=null),n}},i.fn.init.prototype=i.fn,r={ajaxSend:function(t,i,r){n.ajax(t.url+"/send",{global:!1,type:"POST",dataType:"json",data:{data:i,transport:r,clientId:t.clientId},success:function(i){i&&n(t).trigger("onReceived",[i])},error:function(i,r){if(r==="abort")return;n(t).trigger("onError",[i])}})},foreverFrame:{count:0,connections:{}}},i.transports={webSockets:{send:function(n,t){n.socket.send(t)},start:function(i,r,u){var f,o=!1,e;t.MozWebSocket&&(t.WebSocket=t.MozWebSocket);if(!t.WebSocket){u();return}i.socket||(f=document.location.host+i.appRelativeUrl,n(i).trigger("onSending"),f+=i.data?"?connectionData="+i.data+"&transport=webSockets&clientId="+i.clientId:"?transport=webSockets&clientId="+i.clientId,e=document.location.protocol==="https:"?"wss://":"ws://",i.socket=new t.WebSocket(e+f),i.socket.onopen=function(){o=!0,r&&r()},i.socket.onclose=function(t){o?typeof t.wasClean!="undefined"&&t.wasClean===!1&&n(i).trigger("onError"):u&&u(),i.socket=null},i.socket.onmessage=function(r){var u=t.JSON.parse(r.data);u&&(u.Messages?n.each(u.Messages,function(){n(i).trigger("onReceived",[this])}):n(i).trigger("onReceived",[u]))})},stop:function(n){n.socket!==null&&(n.socket.close(),n.socket=null)}},serverSentEvents:{start:function(i,r,f){var s=this,o=!1,e=i.url+"/connect";i.eventSource&&i.stop();if(!t.EventSource){f();return}n(i).trigger("onSending"),e+=i.data?"?connectionData="+i.data+"&transport=serverSentEvents&clientId="+i.clientId:"?transport=serverSentEvents&clientId="+i.clientId,i.eventSource=new t.EventSource(e),i.eventSource.addEventListener("open",function(){},!1),i.eventSource.addEventListener("message",function(f){u("SignalR: EventSource message received - "+f.data);if(f.data==="initialized"){o||(o=!0,r());return}var e=t.JSON.parse(f.data);e&&(e.Messages?n.each(e.Messages,function(){n(i).trigger("onReceived",[this])}):n(i).trigger("onReceived",[e]))},!1),i.eventSource.addEventListener("error",function(t){t.eventPhase==EventSource.CLOSED?(u("SignalR: EventSource closed"),o||f(),s.stop()):(u("SignalR: EventSource error"),n(instance).trigger("onError",[data]))},!1)},send:function(n,t){r.ajaxSend(n,t,"serverSentEvents")},stop:function(n){n&&n.eventSource&&(n.eventSource.close(),n.eventSource=null)}},foreverFrame:{start:function(i,f){var h=r.foreverFrame.count+=1,s=i.url+"/connect",o=n("<iframe data-signalr-connection-id='"+i.clientId+"' style='position:absolute;width:0;height:0;visibility:hidden;'></iframe>");n(i).trigger("onSending"),s+=i.data?"?connectionData="+i.data+"&transport=foreverFrame&clientId="+t.escape(i.clientId):"?transport=foreverFrame&clientId="+t.escape(i.clientId),s+="&frameId="+h,o.prop("src",s),r.foreverFrame.connections[h]=i,o.bind("load",function(){u("SignalR: forever frame iframe load event fired"),t.setTimeout(function(){var n=this.src.replace("/connect","")+"&messageId="+i.messageId;this.src=n},2e3)}),i.frame=o,i.frameId=h,f&&(i.onSuccess=f),n("body").append(o)},send:function(n,t){r.ajaxSend(n,t,"foreverFrame")},receive:function(t,i){i&&(i.Messages&&n.each(i.Messages,function(){try{n(t).trigger("onReceived",[this])}catch(i){u("Error raising received "+i)}}),t.messageId=i.MessageId,t.groups=i.TransportData.Groups)},stop:function(n){n.frame&&(n.frame.remove(),delete r.foreverFrame.connections[n.frameId])},getConnection:function(n){return r.foreverFrame.connections[n]},started:function(n){n.onSuccess&&n.onSuccess()}},longPolling:{start:function(i,r){i.pollXhr&&i.stop(),i.messageId=null,t.setTimeout(function(){(function f(i){n(i).trigger("onSending");var r=i.messageId,o=r===null,e=i.url+(o?"/connect":"");i.pollXhr=n.ajax(e,{global:!1,type:"POST",data:{clientId:i.clientId,messageId:r,connectionData:i.data,transport:"longPolling",groups:(i.groups||[]).toString()},dataType:"json",success:function(r){var e=0;r&&(r.Messages&&n.each(r.Messages,function(){try{n(i).trigger("onReceived",[this])}catch(t){u("Error raising received "+t)}}),i.messageId=r.MessageId,n.type(r.TransportData.LongPollDelay)==="number"&&(e=r.TransportData.LongPollDelay),i.groups=r.TransportData.Groups),e>0?t.setTimeout(function(){f(i)},e):f(i)},error:function(r,u){if(u==="abort")return;n(i).trigger("onError",[r]),t.setTimeout(function(){f(i)},2e3)}})})(i),setTimeout(r,150)},250)},send:function(n,t){r.ajaxSend(n,t,"longPolling")},stop:function(n){n.pollXhr&&(n.pollXhr.abort(),n.pollXhr=null)}}},i.noConflict=function(){return n.connection===i&&(n.connection=f),i},n.connection&&(f=n.connection),n.connection=n.signalR=i})(window.jQuery,window)