(function(n,t){"use strict";var r,f,u,i;if(typeof n!="function")throw"SignalR: jQuery not found. Please ensure jQuery is referenced before the SignalR.js file.";if(!t.JSON)throw"SignalR: No JSON parser found. Please ensure json2.js is referenced before the SignalR.js file if you need to support clients without native JSON parsing support, e.g. IE<8.";u=typeof console!="undefined"&&console&&console.debug?function(n){console.debug(n)}:n.noop,r=function(n){return new r.fn.init(n)},r.fn=r.prototype={init:function(n){this.url=n},start:function(i,u){var f=this,e={transport:"auto"},o;return f.transport?f:(n.type(i)==="function"?u=i:n.type(i)==="object"&&(n.extend(e,i),n.type(e.callback)==="function"&&(u=e.callback)),n.type(u)==="function"&&n(f).bind("onStart",function(){u.call(f)}),o=function(t,i){i=i||0;if(i>=t.length){if(!f.transport)throw"SignalR: No transport could be initialized successfully. Try specifying a different transport or none at all for auto initialization.";return}var u=t[i],e=n.type(u)==="object"?u:r.transports[u];e.start(f,function(){f.transport=e,n(f).trigger("onStart")},function(){o(t,i+1)})},t.setTimeout(function(){n.ajax(f.url+"/negotiate",{global:!1,type:"POST",data:{},success:function(t){f.appRelativeUrl=t.Url,f.id=t.ConnectionId,f.webSocketServerUrl=t.WebSocketServerUrl;if(!t.ProtocolVersion||t.ProtocolVersion!=="1.0")throw"SignalR: Incompatible protocol version.";n(f).trigger("onStarting");var u=[],i=[];n.each(r.transports,function(n){if(n==="webSockets"&&!t.TryWebSockets)return!0;i.push(n)}),n.isArray(e.transport)?n.each(e.transport,function(){var t=this;n.type(t)!=="object"&&(n.type(t)!=="string"||n.inArray(""+t,i)<0)||u.push(n.type(t)==="string"?""+t:t)}):n.type(e.transport)!=="object"&&n.inArray(e.transport,i)<0?u=i:u.push(e.transport),o(u)}})},0),f)},starting:function(t){var i=this,r=n(i);return r.bind("onStarting",function(){t.call(i),r.unbind("onStarting")}),i},send:function(n){var t=this;if(!t.transport)throw"SignalR: Connection must be started before data can be sent. Call .start() before .send()";return t.transport.send(t,n),t},sending:function(t){var i=this;return n(i).bind("onSending",function(){t.call(i)}),i},received:function(t){var i=this;return n(i).bind("onReceived",function(n,r){t.call(i,r)}),i},error:function(t){var i=this;return n(i).bind("onError",function(){t.call(i)}),i},stop:function(){var n=this;return n.transport&&(n.transport.stop(n),n.transport=null),delete n.messageId,delete n.groups,n}},r.fn.init.prototype=r.fn,i={getUrl:function(n,i){var u=n.url+"/connect",r="transport="+i+"&connectionId="+t.escape(n.id);return n.data&&(r="connectionData="+t.escape(n.data)+"&"+r),u+="?"+r},ajaxSend:function(i,r){n.ajax(i.url+"/send?transport="+i.transport.name+"&connectionId="+t.escape(i.id),{global:!1,type:"POST",dataType:"json",data:{data:r},success:function(t){t&&n(i).trigger("onReceived",[t])},error:function(t,r){if(r==="abort")return;n(i).trigger("onError",[t])}})},processMessages:function(t,i){var r;if(i){if(i.Disconnect){t.stop().start();return}i.Messages&&(r=n(t),n.each(i.Messages,function(){try{r.trigger("onReceived",[this])}catch(n){u("Error raising received "+n)}})),t.messageId=i.MessageId,t.groups=i.TransportData.Groups}},foreverFrame:{count:0,connections:{}}},r.transports={webSockets:{name:"webSockets",send:function(n,t){n.socket.send(t)},start:function(i,r,f){var e,s=!1,o;t.MozWebSocket&&(t.WebSocket=t.MozWebSocket);if(!t.WebSocket){f();return}i.socket||(i.webSocketServerUrl?e=i.webSocketServerUrl:(o=document.location.protocol==="https:"?"wss://":"ws://",e=o+document.location.host+i.appRelativeUrl),n(i).trigger("onSending"),e+=i.data?"?connectionData="+i.data+"&transport=webSockets&connectionId="+i.id:"?transport=webSockets&connectionId="+i.id,i.socket=new t.WebSocket(e),i.socket.onopen=function(){s=!0,r&&r()},i.socket.onclose=function(t){s?typeof t.wasClean!="undefined"&&t.wasClean===!1&&n(i).trigger("onError"):f&&f(),i.socket=null},i.socket.onmessage=function(r){var f=t.JSON.parse(r.data),e;f&&(e=n(i),f.Messages?n.each(f.Messages,function(){try{e.trigger("onReceived",[this])}catch(n){u("Error raising received "+n)}}):e.trigger("onReceived",[f]))})},stop:function(n){n.socket!==null&&(n.socket.close(),n.socket=null)}},serverSentEvents:{name:"serverSentEvents",start:function(r,f,e){var h=this,s=!1,o;r.eventSource&&r.stop();if(!t.EventSource){e();return}n(r).trigger("onSending"),o=i.getUrl(r,this.name),r.eventSource=new t.EventSource(o),r.eventSource.addEventListener("open",function(){s=!0,f()},!1),r.eventSource.addEventListener("message",function(n){if(n.data==="initialized")return;var u=t.JSON.parse(n.data);i.processMessages(r,u)},!1),r.eventSource.addEventListener("error",function(t){s||e(),t.eventPhase==EventSource.CLOSED?(u("SignalR: EventSource closed"),h.stop()):(u("SignalR: EventSource error"),n(instance).trigger("onError",[data]))},!1)},send:function(n,t){i.ajaxSend(n,t)},stop:function(n){n&&n.eventSource&&(n.eventSource.close(),n.eventSource=null)}},foreverFrame:{name:"foreverFrame",start:function(t,r){var h=this,s=i.foreverFrame.count+=1,o,e=n("<iframe data-signalr-connection-id='"+t.id+"' style='position:absolute;width:0;height:0;visibility:hidden;'></iframe>");n(t).trigger("onSending"),o=i.getUrl(t,this.name),o+="&frameId="+s,e.prop("src",o),i.foreverFrame.connections[s]=t,e.bind("load",function(){u("SignalR: forever frame iframe load event fired"),h.reconnect(t)}),t.frame=e[0],t.frameId=s,r&&(t.onSuccess=r),n("body").append(e)},reconnect:function(n){t.setTimeout(function(){var t=n.frame,i=t.src.replace("/connect","")+"&messageId="+n.messageId+"&groups="+escape(n.groups);t.src=i},2e3)},send:function(n,t){i.ajaxSend(n,t)},receive:i.processMessages,stop:function(n){n.frame&&(n.frame.remove(),delete i.foreverFrame.connections[n.frameId])},getConnection:function(n){return i.foreverFrame.connections[n]},started:function(n){n.onSuccess&&n.onSuccess()}},longPolling:{name:"longPolling",start:function(r,u){r.pollXhr&&r.stop(),r.messageId=null,t.setTimeout(function(){(function f(r){n(r).trigger("onSending");var u=r.messageId,o=u===null,e=r.url+(o?"/connect":"")+"?transport=longPolling&connectionId="+escape(r.id)+"&messageId="+u+"&groups="+escape((r.groups||[]).toString());r.pollXhr=n.ajax(e,{global:!1,type:"POST",data:{connectionData:r.data},dataType:"json",success:function(u){var e=0;i.processMessages(r,u),u&&n.type(u.TransportData.LongPollDelay)==="number"&&(e=u.TransportData.LongPollDelay),e>0?t.setTimeout(function(){f(r)},e):f(r)},error:function(i,u){if(u==="abort")return;n(r).trigger("onError",[i]),t.setTimeout(function(){f(r)},2e3)}})})(r),setTimeout(u,150)},250)},send:function(n,t){i.ajaxSend(n,t)},stop:function(n){n.pollXhr&&(n.pollXhr.abort(),n.pollXhr=null)}}},r.noConflict=function(){return n.connection===r&&(n.connection=f),r},n.connection&&(f=n.connection),n.connection=n.signalR=r})(window.jQuery,window)